#!/bin/bash

# This script will do a minimal amount of environment setup and then execute
# the agent binary in a way that should work portably across any Linux distro.

# This assumes that this script is located in a directory that contains a
# "bundle" directory that contains the actual agent bundle generated by the
# Dockerfile.

set -e

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

cd $SCRIPT_DIR/bundle
export PYTHONHOME="$(pwd)"
export LD_LIBRARY_PATH=$(pwd)/lib
export JAVA_HOME="$(pwd)/jvm/java-8-openjdk-amd64"

loader=$(pwd)/lib64/ld-linux-x86-64.so.2

# The agent assumes it can access the root filesystem of the current host at
# ./hostfs.
$loader $(pwd)/bin/ln -fns / $(pwd)/hostfs

exec -a signalfx-agent $loader bin/signalfx-agent $@
